(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{6880:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return H}});var s,n,r,i,c,o,l,d,h=a(7821),u=a(3523),m=a(6925),x=a(8078),_=a(7597),p=a(4435),j=a(5515);(s=c||(c={})).FOOD="food",s.WATER="water",s.WOOD="wood",s.STONE="stone",s.COIN="coin",(n=o||(o={})).GATHER_WATER="gather_water",n.GATHER_FOOD="gather_food",n.TRADE="trade",n.REST="rest",n.MOVE="move",(r=l||(l={})).CONNECT="connect",r.DISCONNECT="disconnect",r.PLAYER_UPDATE="player_update",r.GAME_STATE="game_state",r.ACTION="action",r.CHAT="chat",(i=d||(d={})).WELL="well",i.MARKET="market",i.HOUSE="house",i.FARM="farm",i.TAVERN="tavern";let v={PLAYER_MOVE_SPEED:5,RUN_SPEED_MULTIPLIER:1.5,TOWN_SIZE:200};var E=a(8587);let y=(0,E.cn)(null),g=(0,E.cn)(!1),w=(0,E.cn)(new Map),N=(0,E.cn)(null),f=(0,E.cn)(e=>Array.from(e(w).values())),I=(0,E.cn)(null,(e,t,a)=>{let s=new Map(e(w));s.set(a.id,a),t(w,s),a.id===e(y)&&t(N,a.stats)}),b=(0,E.cn)(null,(e,t,a)=>{let s=new Map(e(w));s.delete(a),t(w,s)});function R(){let{camera:e}=(0,_.D)(),t=(0,x.useRef)({}),a=(0,x.useRef)(new p.Vector3),s=(0,x.useRef)(new p.Vector3),n=(0,j.Dv)(y);return(0,x.useEffect)(()=>{let e=e=>{t.current[e.key.toLowerCase()]=!0},a=e=>{t.current[e.key.toLowerCase()]=!1};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}},[]),(0,_.F)((r,i)=>{if(!n)return;let c=t.current,o=s.current;if(o.set(0,0,0),c.w&&(o.z-=1),c.s&&(o.z+=1),c.a&&(o.x-=1),c.d&&(o.x+=1),o.length()>0){o.normalize();let t=c.shift?v.PLAYER_MOVE_SPEED*v.RUN_SPEED_MULTIPLIER:v.PLAYER_MOVE_SPEED;o.applyEuler(e.rotation),o.y=0,o.normalize(),a.current.x=o.x*t,a.current.z=o.z*t,e.position.x+=a.current.x*i,e.position.z+=a.current.z*i,e.position.y=2;let s=v.TOWN_SIZE/2;e.position.x=Math.max(-s,Math.min(s,e.position.x)),e.position.z=Math.max(-s,Math.min(s,e.position.z))}}),null}function C(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],receiveShadow:!0,position:[0,0,0],children:[(0,h.jsx)("planeGeometry",{args:[400,400]}),(0,h.jsx)("meshStandardMaterial",{color:"#6b8e23",roughness:.8})]}),(0,h.jsx)("gridHelper",{args:[400,40,8947848,4473924]})]})}var D=a(8874);function S(e){let{player:t}=e,a=(0,x.useRef)(null),s=["#ff6b6b","#4dabf7","#51cf66","#ffd43b","#f06595","#845ef7"],n=s[Math.abs(t.id.split("").reduce((e,t)=>e+t.charCodeAt(0),0))%s.length];return(0,h.jsxs)("group",{position:[t.position.x,t.position.y+1,t.position.z],rotation:[0,t.rotation,0],children:[(0,h.jsxs)("mesh",{ref:a,castShadow:!0,children:[(0,h.jsx)("capsuleGeometry",{args:[.5,1.5,4,8]}),(0,h.jsx)("meshStandardMaterial",{color:n})]}),(0,h.jsx)(D.x,{position:[0,2,0],fontSize:.4,color:"white",anchorX:"center",anchorY:"middle",outlineWidth:.03,outlineColor:"#000000",children:t.name})]})}function T(){let e=(0,j.Dv)(f),t=(0,j.Dv)(y);return(0,h.jsx)(h.Fragment,{children:e.filter(e=>e.id!==t).map(e=>(0,h.jsx)(S,{player:e},e.id))})}let A={[d.WELL]:"#4a5568",[d.MARKET]:"#d97706",[d.FARM]:"#92400e",[d.TAVERN]:"#7c2d12",[d.HOUSE]:"#666666"},L=[{id:"well-1",type:d.WELL,position:{x:-20,y:0,z:-20},name:"Town Well"},{id:"market-1",type:d.MARKET,position:{x:30,y:0,z:-10},name:"Market Square"},{id:"farm-1",type:d.FARM,position:{x:-40,y:0,z:30},name:"Community Farm"},{id:"tavern-1",type:d.TAVERN,position:{x:0,y:0,z:0},name:"The Rusty Tankard"}];function k(e){let{building:t}=e,a=(0,x.useRef)(null);return(0,h.jsxs)("group",{position:[t.position.x,t.position.y,t.position.z],children:[(0,h.jsxs)("mesh",{ref:a,position:[0,2,0],castShadow:!0,receiveShadow:!0,children:[(()=>{switch(t.type){case d.WELL:return(0,h.jsx)("cylinderGeometry",{args:[2,2,3,16]});case d.MARKET:return(0,h.jsx)("boxGeometry",{args:[8,4,8]});case d.FARM:return(0,h.jsx)("boxGeometry",{args:[10,3,6]});case d.TAVERN:return(0,h.jsx)("boxGeometry",{args:[6,5,6]});default:return(0,h.jsx)("boxGeometry",{args:[5,4,5]})}})(),(0,h.jsx)("meshStandardMaterial",{color:A[t.type]})]}),(0,h.jsx)(D.x,{position:[0,6,0],fontSize:.8,color:"white",anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000000",children:t.name})]})}function M(){let[e]=(0,x.useState)(L);return(0,h.jsx)(h.Fragment,{children:e.map(e=>(0,h.jsx)(k,{building:e},e.id))})}function U(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("color",{attach:"background",args:["#87ceeb"]}),(0,h.jsx)("fog",{attach:"fog",args:["#87ceeb",50,300]}),(0,h.jsx)("ambientLight",{intensity:.6}),(0,h.jsx)("directionalLight",{position:[50,100,50],intensity:.8,castShadow:!0,"shadow-camera-left":-100,"shadow-camera-right":100,"shadow-camera-top":100,"shadow-camera-bottom":-100,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048}),(0,h.jsx)(C,{}),(0,h.jsx)(M,{}),(0,h.jsx)(T,{}),(0,h.jsx)(R,{})]})}var O=a(489),W=a.n(O);function P(){let e=(0,j.Dv)(g),t=(0,j.Dv)(N),a=(0,j.Dv)(f),s=(0,j.Dv)(y),n=(0,x.useRef)(null);(0,x.useEffect)(()=>{let e=setInterval(()=>{window.gameWs&&(n.current=window.gameWs,clearInterval(e))},100);return()=>clearInterval(e)},[]);let r=e=>{var t;if((null===(t=n.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&s){let t={type:l.ACTION,data:{type:e,playerId:s},timestamp:Date.now()};n.current.send(JSON.stringify(t))}},i=e=>{switch(e.key.toLowerCase()){case"e":r(o.GATHER_WATER);break;case"f":r(o.GATHER_FOOD);break;case"r":r(o.REST)}};(0,x.useEffect)(()=>(window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)),[s]);let c=e=>e>75?"\uD83D\uDC9A":e>50?"\uD83D\uDC9B":e>25?"\uD83E\uDDE1":"❤️",d=e=>e>60?W().statGood:e>20?W().statWarning:W().statCritical,u=e=>{switch(e){case"hunger":return"\uD83C\uDF56";case"thirst":return"\uD83D\uDCA7";case"energy":return"⚡";case"health":return"❤️";default:return""}};return(0,h.jsxs)("div",{className:W().uiOverlay,children:[(0,h.jsx)("div",{className:"".concat(W().connectionStatus," ").concat(e?W().connected:W().disconnected),children:e?"Connected":"Disconnected"}),t&&(0,h.jsxs)("div",{className:W().statsPanel,children:[(0,h.jsx)("h3",{children:"Survival Stats"}),(0,h.jsxs)("div",{className:"".concat(W().statBar," ").concat(t.hunger<20?W().statBarCritical:""),children:[(0,h.jsxs)("div",{className:W().statHeader,children:[(0,h.jsxs)("div",{className:W().statLabel,children:[(0,h.jsx)("span",{className:W().statIcon,children:u("hunger")}),"Hunger"]}),(0,h.jsxs)("div",{className:W().statValue,children:[Math.round(t.hunger),"%"]})]}),(0,h.jsx)("div",{className:W().bar,children:(0,h.jsx)("div",{className:"".concat(W().barFill," ").concat(d(t.hunger)),style:{width:"".concat(Math.max(0,t.hunger),"%")}})}),t.hunger<20&&(0,h.jsx)("div",{className:W().criticalWarning,children:"⚠️ Critical!"})]}),(0,h.jsxs)("div",{className:"".concat(W().statBar," ").concat(t.thirst<20?W().statBarCritical:""),children:[(0,h.jsxs)("div",{className:W().statHeader,children:[(0,h.jsxs)("div",{className:W().statLabel,children:[(0,h.jsx)("span",{className:W().statIcon,children:u("thirst")}),"Thirst"]}),(0,h.jsxs)("div",{className:W().statValue,children:[Math.round(t.thirst),"%"]})]}),(0,h.jsx)("div",{className:W().bar,children:(0,h.jsx)("div",{className:"".concat(W().barFill," ").concat(d(t.thirst)),style:{width:"".concat(Math.max(0,t.thirst),"%")}})}),t.thirst<20&&(0,h.jsx)("div",{className:W().criticalWarning,children:"⚠️ Critical!"})]}),(0,h.jsxs)("div",{className:"".concat(W().statBar," ").concat(t.energy<20?W().statBarCritical:""),children:[(0,h.jsxs)("div",{className:W().statHeader,children:[(0,h.jsxs)("div",{className:W().statLabel,children:[(0,h.jsx)("span",{className:W().statIcon,children:u("energy")}),"Energy"]}),(0,h.jsxs)("div",{className:W().statValue,children:[Math.round(t.energy),"%"]})]}),(0,h.jsx)("div",{className:W().bar,children:(0,h.jsx)("div",{className:"".concat(W().barFill," ").concat(d(t.energy)),style:{width:"".concat(Math.max(0,t.energy),"%")}})}),t.energy<20&&(0,h.jsx)("div",{className:W().criticalWarning,children:"⚠️ Critical!"})]}),(0,h.jsxs)("div",{className:"".concat(W().statBar," ").concat(t.health<20?W().statBarCritical:""),children:[(0,h.jsxs)("div",{className:W().statHeader,children:[(0,h.jsxs)("div",{className:W().statLabel,children:[(0,h.jsx)("span",{className:W().statIcon,children:u("health")}),"Health"]}),(0,h.jsxs)("div",{className:W().statValue,children:[Math.round(t.health),"%"]})]}),(0,h.jsx)("div",{className:W().bar,children:(0,h.jsx)("div",{className:"".concat(W().barFill," ").concat(d(t.health)),style:{width:"".concat(Math.max(0,t.health),"%")}})}),t.health<20&&(0,h.jsx)("div",{className:W().criticalWarning,children:"⚠️ Critical!"})]})]}),(0,h.jsxs)("div",{className:W().actionsPanel,children:[(0,h.jsx)("button",{className:W().actionBtn,onClick:()=>r(o.GATHER_WATER),children:"Drink Water [E]"}),(0,h.jsx)("button",{className:W().actionBtn,onClick:()=>r(o.GATHER_FOOD),children:"Eat Food [F]"}),(0,h.jsx)("button",{className:W().actionBtn,onClick:()=>r(o.REST),children:"Rest [R]"})]}),(0,h.jsxs)("div",{className:W().controlsHelp,children:[(0,h.jsx)("h4",{children:"Controls"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{children:"WASD - Move"}),(0,h.jsx)("div",{children:"Mouse - Look Around"}),(0,h.jsx)("div",{children:"E - Drink Water"}),(0,h.jsx)("div",{children:"F - Eat Food"}),(0,h.jsx)("div",{children:"R - Rest"}),(0,h.jsx)("div",{children:"Click to lock pointer"})]})]}),(0,h.jsxs)("div",{className:W().playersList,children:[(0,h.jsxs)("h4",{children:["Online Players (",a.length,")"]}),(0,h.jsx)("div",{className:W().playersContainer,children:a.map(e=>(0,h.jsxs)("div",{className:W().playerItem,children:[e.name," ",c(e.stats.health)]},e.id))})]})]})}function F(){let e=(0,x.useRef)(null),t=(0,x.useRef)(0),{camera:a}=(0,_.D)(),s=(0,j.b9)(y),n=(0,j.b9)(g),r=(0,j.b9)(I),i=(0,j.b9)(b);return(0,x.useEffect)(()=>{let c="ws://".concat(window.location.hostname,":").concat(3e3),o=()=>{try{let a=new WebSocket(c);e.current=a,window.gameWs=a,a.onopen=()=>{console.log("WebSocket connected"),n(!0),t.current=0},a.onmessage=e=>{let t=JSON.parse(e.data);d(t)},a.onclose=()=>{console.log("WebSocket disconnected"),n(!1),t.current<5&&(t.current++,console.log("Reconnecting... (".concat(t.current,"/5)")),setTimeout(o,2e3))},a.onerror=e=>{console.error("WebSocket error:",e)}}catch(e){console.error("Failed to connect:",e)}},d=e=>{switch(e.type){case l.CONNECT:s(e.data.playerId),console.log("Connected with ID:",e.data.playerId);break;case l.PLAYER_UPDATE:r(e.data);break;case l.GAME_STATE:e.data.players.forEach(e=>{r(e)});break;case l.DISCONNECT:i(e.data.playerId)}};o();let h=setInterval(()=>{var t;if((null===(t=e.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN){let t={type:l.PLAYER_UPDATE,data:{position:{x:a.position.x,y:a.position.y,z:a.position.z},rotation:a.rotation.y},timestamp:Date.now()};e.current.send(JSON.stringify(t))}},50);return()=>{clearInterval(h),e.current&&e.current.close()}},[a,s,n,r,i]),null}function H(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(u.Xz,{shadows:!0,camera:{position:[0,2,5],fov:75},style:{width:"100vw",height:"100vh"},children:[(0,h.jsx)(U,{}),(0,h.jsx)(m.q,{})]}),(0,h.jsx)(P,{}),(0,h.jsx)(F,{})]})}},489:function(e){e.exports={uiOverlay:"UI_uiOverlay__BKfMY",connectionStatus:"UI_connectionStatus__w3d7C",connected:"UI_connected__cT2Je",disconnected:"UI_disconnected___vRjL",statsPanel:"UI_statsPanel__17EBV",statBar:"UI_statBar__SRhef",statBarCritical:"UI_statBarCritical__Du_UC",pulse:"UI_pulse__fLdmq",statHeader:"UI_statHeader__QuI7j",statLabel:"UI_statLabel__NTNgO",statIcon:"UI_statIcon__Piyei",statValue:"UI_statValue__mm0D7",bar:"UI_bar__2pXTm",barFill:"UI_barFill__r5Uke",statGood:"UI_statGood__Ge_pw",statWarning:"UI_statWarning__PIv5q",statCritical:"UI_statCritical__kDbKZ",barPulse:"UI_barPulse__fGZLC",criticalWarning:"UI_criticalWarning__cbrvg",warningBlink:"UI_warningBlink__sPZmg",actionsPanel:"UI_actionsPanel__H5jBH",actionBtn:"UI_actionBtn__s4aXI",controlsHelp:"UI_controlsHelp__DpTpS",playersList:"UI_playersList__N2Vqr",playersContainer:"UI_playersContainer__dHxIt",playerItem:"UI_playerItem__xJWpy"}}}]);