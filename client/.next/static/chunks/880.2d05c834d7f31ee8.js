(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{6880:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return H}});var n,s,r,o,i,c,l,d,h=a(7821),u=a(3523),x=a(6925),m=a(8078),_=a(7597),E=a(4435),p=a(5515);(n=i||(i={})).FOOD="food",n.WATER="water",n.WOOD="wood",n.STONE="stone",n.COIN="coin",(s=c||(c={})).GATHER_WATER="gather_water",s.GATHER_FOOD="gather_food",s.TRADE="trade",s.REST="rest",s.MOVE="move",(r=l||(l={})).CONNECT="connect",r.DISCONNECT="disconnect",r.PLAYER_UPDATE="player_update",r.GAME_STATE="game_state",r.ACTION="action",r.CHAT="chat",r.PLAYER_DEATH="player_death",r.PLAYER_RESPAWN="player_respawn",(o=d||(d={})).WELL="well",o.MARKET="market",o.HOUSE="house",o.FARM="farm",o.TAVERN="tavern";let v={PLAYER_MOVE_SPEED:5,RUN_SPEED_MULTIPLIER:1.5,TOWN_SIZE:200,RESPAWN_DELAY_SECONDS:5};var y=a(8587);let j=(0,y.cn)(null),w=(0,y.cn)(!1),f=(0,y.cn)(new Map),N=(0,y.cn)(null),S=(0,y.cn)(!1),R=(0,y.cn)(e=>Array.from(e(f).values())),g=(0,y.cn)(null,(e,t,a)=>{let n=new Map(e(f));n.set(a.id,a),t(f,n),a.id===e(j)&&(t(N,a.stats),t(S,a.isDead))}),b=(0,y.cn)(null,(e,t,a)=>{let n=new Map(e(f));n.delete(a),t(f,n)});function A(){let{camera:e}=(0,_.D)(),t=(0,m.useRef)({}),a=(0,m.useRef)(new E.Vector3),n=(0,m.useRef)(new E.Vector3),s=(0,p.Dv)(j);return(0,m.useEffect)(()=>{let e=e=>{t.current[e.key.toLowerCase()]=!0},a=e=>{t.current[e.key.toLowerCase()]=!1};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}},[]),(0,_.F)((r,o)=>{if(!s)return;let i=t.current,c=n.current;if(c.set(0,0,0),i.w&&(c.z-=1),i.s&&(c.z+=1),i.a&&(c.x-=1),i.d&&(c.x+=1),c.length()>0){c.normalize();let t=i.shift?v.PLAYER_MOVE_SPEED*v.RUN_SPEED_MULTIPLIER:v.PLAYER_MOVE_SPEED;c.applyEuler(e.rotation),c.y=0,c.normalize(),a.current.x=c.x*t,a.current.z=c.z*t,e.position.x+=a.current.x*o,e.position.z+=a.current.z*o,e.position.y=2;let n=v.TOWN_SIZE/2;e.position.x=Math.max(-n,Math.min(n,e.position.x)),e.position.z=Math.max(-n,Math.min(n,e.position.z))}}),null}function T(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],receiveShadow:!0,position:[0,0,0],children:[(0,h.jsx)("planeGeometry",{args:[400,400]}),(0,h.jsx)("meshStandardMaterial",{color:"#6b8e23",roughness:.8})]}),(0,h.jsx)("gridHelper",{args:[400,40,8947848,4473924]})]})}var D=a(8874);function I(e){let{player:t}=e,a=(0,m.useRef)(null),n=["#ff6b6b","#4dabf7","#51cf66","#ffd43b","#f06595","#845ef7"],s=n[Math.abs(t.id.split("").reduce((e,t)=>e+t.charCodeAt(0),0))%n.length];return(0,h.jsxs)("group",{position:[t.position.x,t.position.y+1,t.position.z],rotation:[0,t.rotation,0],children:[(0,h.jsxs)("mesh",{ref:a,castShadow:!0,children:[(0,h.jsx)("capsuleGeometry",{args:[.5,1.5,4,8]}),(0,h.jsx)("meshStandardMaterial",{color:s})]}),(0,h.jsx)(D.x,{position:[0,2,0],fontSize:.4,color:"white",anchorX:"center",anchorY:"middle",outlineWidth:.03,outlineColor:"#000000",children:t.name})]})}function L(){let e=(0,p.Dv)(R),t=(0,p.Dv)(j);return(0,h.jsx)(h.Fragment,{children:e.filter(e=>e.id!==t).map(e=>(0,h.jsx)(I,{player:e},e.id))})}let k={[d.WELL]:"#4a5568",[d.MARKET]:"#d97706",[d.FARM]:"#92400e",[d.TAVERN]:"#7c2d12",[d.HOUSE]:"#666666"},O=[{id:"well-1",type:d.WELL,position:{x:-20,y:0,z:-20},name:"Town Well"},{id:"market-1",type:d.MARKET,position:{x:30,y:0,z:-10},name:"Market Square"},{id:"farm-1",type:d.FARM,position:{x:-40,y:0,z:30},name:"Community Farm"},{id:"tavern-1",type:d.TAVERN,position:{x:0,y:0,z:0},name:"The Rusty Tankard"}];function C(e){let{building:t}=e,a=(0,m.useRef)(null);return(0,h.jsxs)("group",{position:[t.position.x,t.position.y,t.position.z],children:[(0,h.jsxs)("mesh",{ref:a,position:[0,2,0],castShadow:!0,receiveShadow:!0,children:[(()=>{switch(t.type){case d.WELL:return(0,h.jsx)("cylinderGeometry",{args:[2,2,3,16]});case d.MARKET:return(0,h.jsx)("boxGeometry",{args:[8,4,8]});case d.FARM:return(0,h.jsx)("boxGeometry",{args:[10,3,6]});case d.TAVERN:return(0,h.jsx)("boxGeometry",{args:[6,5,6]});default:return(0,h.jsx)("boxGeometry",{args:[5,4,5]})}})(),(0,h.jsx)("meshStandardMaterial",{color:k[t.type]})]}),(0,h.jsx)(D.x,{position:[0,6,0],fontSize:.8,color:"white",anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000000",children:t.name})]})}function M(){let[e]=(0,m.useState)(O);return(0,h.jsx)(h.Fragment,{children:e.map(e=>(0,h.jsx)(C,{building:e},e.id))})}function P(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("color",{attach:"background",args:["#87ceeb"]}),(0,h.jsx)("fog",{attach:"fog",args:["#87ceeb",50,300]}),(0,h.jsx)("ambientLight",{intensity:.6}),(0,h.jsx)("directionalLight",{position:[50,100,50],intensity:.8,castShadow:!0,"shadow-camera-left":-100,"shadow-camera-right":100,"shadow-camera-top":100,"shadow-camera-bottom":-100,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048}),(0,h.jsx)(T,{}),(0,h.jsx)(M,{}),(0,h.jsx)(L,{}),(0,h.jsx)(A,{})]})}var U=a(489),W=a.n(U);function F(){let e=(0,p.Dv)(w),t=(0,p.Dv)(N),a=(0,p.Dv)(R),n=(0,p.Dv)(j),s=(0,p.Dv)(S),r=(0,m.useRef)(null),[o,i]=(0,m.useState)(0);(0,m.useEffect)(()=>{let e=setInterval(()=>{window.gameWs&&(r.current=window.gameWs,clearInterval(e))},100);return()=>clearInterval(e)},[]);let d=e=>{var t;if((null===(t=r.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&n){let t={type:l.ACTION,data:{type:e,playerId:n},timestamp:Date.now()};r.current.send(JSON.stringify(t))}},u=e=>{switch(e.key.toLowerCase()){case"e":d(c.GATHER_WATER);break;case"f":d(c.GATHER_FOOD);break;case"r":d(c.REST)}};(0,m.useEffect)(()=>(window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)),[n]),(0,m.useEffect)(()=>{if(s){i(v.RESPAWN_DELAY_SECONDS);let e=setInterval(()=>{i(t=>t<=1?(clearInterval(e),0):t-1)},1e3);return()=>clearInterval(e)}i(0)},[s]);let x=e=>e>75?"\uD83D\uDC9A":e>50?"\uD83D\uDC9B":e>25?"\uD83E\uDDE1":"❤️";return(0,h.jsxs)("div",{className:W().uiOverlay,children:[(0,h.jsx)("div",{className:"".concat(W().connectionStatus," ").concat(e?W().connected:W().disconnected),children:e?"Connected":"Disconnected"}),t&&(0,h.jsxs)("div",{className:W().statsPanel,children:[(0,h.jsx)("h3",{children:"Survival Stats"}),(0,h.jsxs)("div",{className:W().statBar,children:[(0,h.jsx)("div",{className:W().statLabel,children:"Hunger"}),(0,h.jsx)("div",{className:W().bar,children:(0,h.jsx)("div",{className:"".concat(W().barFill," ").concat(W().hunger),style:{width:"".concat(Math.max(0,t.hunger),"%")}})})]}),(0,h.jsxs)("div",{className:W().statBar,children:[(0,h.jsx)("div",{className:W().statLabel,children:"Thirst"}),(0,h.jsx)("div",{className:W().bar,children:(0,h.jsx)("div",{className:"".concat(W().barFill," ").concat(W().thirst),style:{width:"".concat(Math.max(0,t.thirst),"%")}})})]}),(0,h.jsxs)("div",{className:W().statBar,children:[(0,h.jsx)("div",{className:W().statLabel,children:"Energy"}),(0,h.jsx)("div",{className:W().bar,children:(0,h.jsx)("div",{className:"".concat(W().barFill," ").concat(W().energy),style:{width:"".concat(Math.max(0,t.energy),"%")}})})]}),(0,h.jsxs)("div",{className:W().statBar,children:[(0,h.jsx)("div",{className:W().statLabel,children:"Health"}),(0,h.jsx)("div",{className:W().bar,children:(0,h.jsx)("div",{className:"".concat(W().barFill," ").concat(W().health),style:{width:"".concat(Math.max(0,t.health),"%")}})})]})]}),(0,h.jsxs)("div",{className:W().actionsPanel,children:[(0,h.jsx)("button",{className:W().actionBtn,onClick:()=>d(c.GATHER_WATER),children:"Drink Water [E]"}),(0,h.jsx)("button",{className:W().actionBtn,onClick:()=>d(c.GATHER_FOOD),children:"Eat Food [F]"}),(0,h.jsx)("button",{className:W().actionBtn,onClick:()=>d(c.REST),children:"Rest [R]"})]}),(0,h.jsxs)("div",{className:W().controlsHelp,children:[(0,h.jsx)("h4",{children:"Controls"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{children:"WASD - Move"}),(0,h.jsx)("div",{children:"Mouse - Look Around"}),(0,h.jsx)("div",{children:"E - Drink Water"}),(0,h.jsx)("div",{children:"F - Eat Food"}),(0,h.jsx)("div",{children:"R - Rest"}),(0,h.jsx)("div",{children:"Click to lock pointer"})]})]}),(0,h.jsxs)("div",{className:W().playersList,children:[(0,h.jsxs)("h4",{children:["Online Players (",a.length,")"]}),(0,h.jsx)("div",{className:W().playersContainer,children:a.map(e=>(0,h.jsxs)("div",{className:W().playerItem,children:[e.name," ",x(e.stats.health)]},e.id))})]}),s&&(0,h.jsxs)("div",{className:W().deathScreen,children:[(0,h.jsx)("h2",{children:"You Died"}),(0,h.jsx)("p",{children:"Your health reached zero!"}),(0,h.jsx)("p",{children:"You will respawn soon..."}),(0,h.jsxs)("div",{className:W().respawnTimer,children:[o,"s"]})]})]})}function z(){let e=(0,m.useRef)(null),t=(0,m.useRef)(0),{camera:a}=(0,_.D)(),n=(0,p.b9)(j),s=(0,p.b9)(w),r=(0,p.b9)(g),o=(0,p.b9)(b);return(0,m.useEffect)(()=>{let i="ws://".concat(window.location.hostname,":").concat(3e3),c=()=>{try{let a=new WebSocket(i);e.current=a,window.gameWs=a,a.onopen=()=>{console.log("WebSocket connected"),s(!0),t.current=0},a.onmessage=e=>{let t=JSON.parse(e.data);d(t)},a.onclose=()=>{console.log("WebSocket disconnected"),s(!1),t.current<5&&(t.current++,console.log("Reconnecting... (".concat(t.current,"/5)")),setTimeout(c,2e3))},a.onerror=e=>{console.error("WebSocket error:",e)}}catch(e){console.error("Failed to connect:",e)}},d=e=>{switch(e.type){case l.CONNECT:n(e.data.playerId),console.log("Connected with ID:",e.data.playerId);break;case l.PLAYER_UPDATE:r(e.data);break;case l.GAME_STATE:e.data.players.forEach(e=>{r(e)});break;case l.DISCONNECT:o(e.data.playerId);break;case l.PLAYER_DEATH:console.log("".concat(e.data.playerName," has died"));break;case l.PLAYER_RESPAWN:r(e.data.player),console.log("".concat(e.data.player.name," has respawned"))}};c();let h=setInterval(()=>{var t;if((null===(t=e.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN){let t={type:l.PLAYER_UPDATE,data:{position:{x:a.position.x,y:a.position.y,z:a.position.z},rotation:a.rotation.y},timestamp:Date.now()};e.current.send(JSON.stringify(t))}},50);return()=>{clearInterval(h),e.current&&e.current.close()}},[a,n,s,r,o]),null}function H(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(u.Xz,{shadows:!0,camera:{position:[0,2,5],fov:75},style:{width:"100vw",height:"100vh"},children:[(0,h.jsx)(P,{}),(0,h.jsx)(x.q,{})]}),(0,h.jsx)(F,{}),(0,h.jsx)(z,{})]})}},489:function(e){e.exports={uiOverlay:"UI_uiOverlay__BKfMY",connectionStatus:"UI_connectionStatus__w3d7C",connected:"UI_connected__cT2Je",disconnected:"UI_disconnected___vRjL",statsPanel:"UI_statsPanel__17EBV",statBar:"UI_statBar__SRhef",statLabel:"UI_statLabel__NTNgO",bar:"UI_bar__2pXTm",barFill:"UI_barFill__r5Uke",hunger:"UI_hunger__66_q5",thirst:"UI_thirst__LV3Q_",energy:"UI_energy__aNiS3",health:"UI_health__cndGF",actionsPanel:"UI_actionsPanel__H5jBH",actionBtn:"UI_actionBtn__s4aXI",controlsHelp:"UI_controlsHelp__DpTpS",playersList:"UI_playersList__N2Vqr",playersContainer:"UI_playersContainer__dHxIt",playerItem:"UI_playerItem__xJWpy",deathScreen:"UI_deathScreen__2huts",respawnTimer:"UI_respawnTimer__C0XE3"}}}]);