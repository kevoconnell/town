(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[710],{7710:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return B}});var n,s,r,o,i,c,l,d,h=a(7821),u=a(3523),m=a(6925),x=a(8078),p=a(7597),_=a(4435),E=a(5515);(n=i||(i={})).FOOD="food",n.WATER="water",n.WOOD="wood",n.STONE="stone",n.COIN="coin",(s=c||(c={})).GATHER_WATER="gather_water",s.GATHER_FOOD="gather_food",s.TRADE="trade",s.REST="rest",s.MOVE="move",(r=l||(l={})).CONNECT="connect",r.DISCONNECT="disconnect",r.PLAYER_UPDATE="player_update",r.GAME_STATE="game_state",r.ACTION="action",r.CHAT="chat",(o=d||(d={})).WELL="well",o.MARKET="market",o.HOUSE="house",o.FARM="farm",o.TAVERN="tavern";let y={PLAYER_MOVE_SPEED:5,RUN_SPEED_MULTIPLIER:1.5,TOWN_SIZE:200,INTERACTION_RADIUS:10};function v(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))}var j=a(8587);let w=(0,j.cn)(null),f=(0,j.cn)(!1),N=(0,j.cn)(new Map),R=(0,j.cn)(null),I=(0,j.cn)([]),b=(0,j.cn)({x:0,y:0,z:0}),T=(0,j.cn)(e=>Array.from(e(N).values())),g=(0,j.cn)(null,(e,t,a)=>{let n=new Map(e(N));n.set(a.id,a),t(N,n),a.id===e(w)&&t(R,a.stats)}),S=(0,j.cn)(null,(e,t,a)=>{let n=new Map(e(N));n.delete(a),t(N,n)});function A(){let{camera:e}=(0,p.D)(),t=(0,x.useRef)({}),a=(0,x.useRef)(new _.Vector3),n=(0,x.useRef)(new _.Vector3),s=(0,E.Dv)(w);return(0,x.useEffect)(()=>{let e=e=>{t.current[e.key.toLowerCase()]=!0},a=e=>{t.current[e.key.toLowerCase()]=!1};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}},[]),(0,p.F)((r,o)=>{if(!s)return;let i=t.current,c=n.current;if(c.set(0,0,0),i.w&&(c.z-=1),i.s&&(c.z+=1),i.a&&(c.x-=1),i.d&&(c.x+=1),c.length()>0){c.normalize();let t=i.shift?y.PLAYER_MOVE_SPEED*y.RUN_SPEED_MULTIPLIER:y.PLAYER_MOVE_SPEED;c.applyEuler(e.rotation),c.y=0,c.normalize(),a.current.x=c.x*t,a.current.z=c.z*t,e.position.x+=a.current.x*o,e.position.z+=a.current.z*o,e.position.y=2;let n=y.TOWN_SIZE/2;e.position.x=Math.max(-n,Math.min(n,e.position.x)),e.position.z=Math.max(-n,Math.min(n,e.position.z))}}),null}function D(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],receiveShadow:!0,position:[0,0,0],children:[(0,h.jsx)("planeGeometry",{args:[400,400]}),(0,h.jsx)("meshStandardMaterial",{color:"#6b8e23",roughness:.8})]}),(0,h.jsx)("gridHelper",{args:[400,40,8947848,4473924]})]})}var L=a(8874);function M(e){let{player:t}=e,a=(0,x.useRef)(null),n=["#ff6b6b","#4dabf7","#51cf66","#ffd43b","#f06595","#845ef7"],s=n[Math.abs(t.id.split("").reduce((e,t)=>e+t.charCodeAt(0),0))%n.length];return(0,h.jsxs)("group",{position:[t.position.x,t.position.y+1,t.position.z],rotation:[0,t.rotation,0],children:[(0,h.jsxs)("mesh",{ref:a,castShadow:!0,children:[(0,h.jsx)("capsuleGeometry",{args:[.5,1.5,4,8]}),(0,h.jsx)("meshStandardMaterial",{color:s})]}),(0,h.jsx)(L.x,{position:[0,2,0],fontSize:.4,color:"white",anchorX:"center",anchorY:"middle",outlineWidth:.03,outlineColor:"#000000",children:t.name})]})}function O(){let e=(0,E.Dv)(T),t=(0,E.Dv)(w);return(0,h.jsx)(h.Fragment,{children:e.filter(e=>e.id!==t).map(e=>(0,h.jsx)(M,{player:e},e.id))})}let k={[d.WELL]:"#4a5568",[d.MARKET]:"#d97706",[d.FARM]:"#92400e",[d.TAVERN]:"#7c2d12",[d.HOUSE]:"#666666"},C=[{id:"well-1",type:d.WELL,position:{x:-20,y:0,z:-20},name:"Town Well"},{id:"market-1",type:d.MARKET,position:{x:30,y:0,z:-10},name:"Market Square"},{id:"farm-1",type:d.FARM,position:{x:-40,y:0,z:30},name:"Community Farm"},{id:"tavern-1",type:d.TAVERN,position:{x:0,y:0,z:0},name:"The Rusty Tankard"}];function U(e){let{building:t}=e,a=(0,x.useRef)(null);return(0,h.jsxs)("group",{position:[t.position.x,t.position.y,t.position.z],children:[(0,h.jsxs)("mesh",{ref:a,position:[0,2,0],castShadow:!0,receiveShadow:!0,children:[(()=>{switch(t.type){case d.WELL:return(0,h.jsx)("cylinderGeometry",{args:[2,2,3,16]});case d.MARKET:return(0,h.jsx)("boxGeometry",{args:[8,4,8]});case d.FARM:return(0,h.jsx)("boxGeometry",{args:[10,3,6]});case d.TAVERN:return(0,h.jsx)("boxGeometry",{args:[6,5,6]});default:return(0,h.jsx)("boxGeometry",{args:[5,4,5]})}})(),(0,h.jsx)("meshStandardMaterial",{color:k[t.type]})]}),(0,h.jsx)(L.x,{position:[0,6,0],fontSize:.8,color:"white",anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000000",children:t.name})]})}function P(){let[e]=(0,x.useState)(C);return(0,h.jsx)(h.Fragment,{children:e.map(e=>(0,h.jsx)(U,{building:e},e.id))})}function F(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("color",{attach:"background",args:["#87ceeb"]}),(0,h.jsx)("fog",{attach:"fog",args:["#87ceeb",50,300]}),(0,h.jsx)("ambientLight",{intensity:.6}),(0,h.jsx)("directionalLight",{position:[50,100,50],intensity:.8,castShadow:!0,"shadow-camera-left":-100,"shadow-camera-right":100,"shadow-camera-top":100,"shadow-camera-bottom":-100,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048}),(0,h.jsx)(D,{}),(0,h.jsx)(P,{}),(0,h.jsx)(O,{}),(0,h.jsx)(A,{})]})}var W=a(489),z=a.n(W);function H(){let e=(0,E.Dv)(f),t=(0,E.Dv)(R),a=(0,E.Dv)(T),n=(0,E.Dv)(w),s=(0,E.Dv)(I),r=(0,E.Dv)(b),o=(0,x.useRef)(null);(0,x.useEffect)(()=>{let e=setInterval(()=>{window.gameWs&&(o.current=window.gameWs,clearInterval(e))},100);return()=>clearInterval(e)},[]);let i=e=>{var t;if((null===(t=o.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&n){let t={type:l.ACTION,data:{type:e,playerId:n},timestamp:Date.now()};o.current.send(JSON.stringify(t))}},u=e=>{switch(e.key.toLowerCase()){case"e":i(c.GATHER_WATER);break;case"f":i(c.GATHER_FOOD);break;case"r":i(c.REST)}};(0,x.useEffect)(()=>(window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)),[n]);let m=e=>e>75?"\uD83D\uDC9A":e>50?"\uD83D\uDC9B":e>25?"\uD83E\uDDE1":"❤️",p=(0,x.useMemo)(()=>({well:s.some(e=>e.type===d.WELL&&v(r,e.position)<=y.INTERACTION_RADIUS),farm:s.some(e=>e.type===d.FARM&&v(r,e.position)<=y.INTERACTION_RADIUS),tavern:s.some(e=>e.type===d.TAVERN&&v(r,e.position)<=y.INTERACTION_RADIUS)}),[s,r]);return(0,h.jsxs)("div",{className:z().uiOverlay,children:[(0,h.jsx)("div",{className:"".concat(z().connectionStatus," ").concat(e?z().connected:z().disconnected),children:e?"Connected":"Disconnected"}),t&&(0,h.jsxs)("div",{className:z().statsPanel,children:[(0,h.jsx)("h3",{children:"Survival Stats"}),(0,h.jsxs)("div",{className:z().statBar,children:[(0,h.jsx)("div",{className:z().statLabel,children:"Hunger"}),(0,h.jsx)("div",{className:z().bar,children:(0,h.jsx)("div",{className:"".concat(z().barFill," ").concat(z().hunger),style:{width:"".concat(Math.max(0,t.hunger),"%")}})})]}),(0,h.jsxs)("div",{className:z().statBar,children:[(0,h.jsx)("div",{className:z().statLabel,children:"Thirst"}),(0,h.jsx)("div",{className:z().bar,children:(0,h.jsx)("div",{className:"".concat(z().barFill," ").concat(z().thirst),style:{width:"".concat(Math.max(0,t.thirst),"%")}})})]}),(0,h.jsxs)("div",{className:z().statBar,children:[(0,h.jsx)("div",{className:z().statLabel,children:"Energy"}),(0,h.jsx)("div",{className:z().bar,children:(0,h.jsx)("div",{className:"".concat(z().barFill," ").concat(z().energy),style:{width:"".concat(Math.max(0,t.energy),"%")}})})]}),(0,h.jsxs)("div",{className:z().statBar,children:[(0,h.jsx)("div",{className:z().statLabel,children:"Health"}),(0,h.jsx)("div",{className:z().bar,children:(0,h.jsx)("div",{className:"".concat(z().barFill," ").concat(z().health),style:{width:"".concat(Math.max(0,t.health),"%")}})})]})]}),p.well&&(0,h.jsx)("div",{className:z().actionPrompt,children:"Press [E] to Drink Water at Well"}),p.farm&&(0,h.jsx)("div",{className:z().actionPrompt,children:"Press [F] to Gather Food at Farm"}),p.tavern&&(0,h.jsx)("div",{className:z().actionPrompt,children:"Press [R] to Rest at Tavern"}),(0,h.jsxs)("div",{className:z().actionsPanel,children:[(0,h.jsx)("button",{className:z().actionBtn,onClick:()=>i(c.GATHER_WATER),disabled:!p.well,style:{opacity:p.well?1:.5},children:"Drink Water [E]"}),(0,h.jsx)("button",{className:z().actionBtn,onClick:()=>i(c.GATHER_FOOD),disabled:!p.farm,style:{opacity:p.farm?1:.5},children:"Eat Food [F]"}),(0,h.jsx)("button",{className:z().actionBtn,onClick:()=>i(c.REST),disabled:!p.tavern,style:{opacity:p.tavern?1:.5},children:"Rest [R]"})]}),(0,h.jsxs)("div",{className:z().controlsHelp,children:[(0,h.jsx)("h4",{children:"Controls"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{children:"WASD - Move"}),(0,h.jsx)("div",{children:"Mouse - Look Around"}),(0,h.jsx)("div",{children:"E - Drink Water"}),(0,h.jsx)("div",{children:"F - Eat Food"}),(0,h.jsx)("div",{children:"R - Rest"}),(0,h.jsx)("div",{children:"Click to lock pointer"})]})]}),(0,h.jsxs)("div",{className:z().playersList,children:[(0,h.jsxs)("h4",{children:["Online Players (",a.length,")"]}),(0,h.jsx)("div",{className:z().playersContainer,children:a.map(e=>(0,h.jsxs)("div",{className:z().playerItem,children:[e.name," ",m(e.stats.health)]},e.id))})]})]})}function G(){let e=(0,x.useRef)(null),t=(0,x.useRef)(0),{camera:a}=(0,p.D)(),n=(0,E.b9)(w),s=(0,E.b9)(f),r=(0,E.b9)(g),o=(0,E.b9)(S),i=(0,E.b9)(I),c=(0,E.b9)(b);return(0,x.useEffect)(()=>{let d="ws://".concat(window.location.hostname,":").concat(3e3),h=()=>{try{let a=new WebSocket(d);e.current=a,window.gameWs=a,a.onopen=()=>{console.log("WebSocket connected"),s(!0),t.current=0},a.onmessage=e=>{let t=JSON.parse(e.data);u(t)},a.onclose=()=>{console.log("WebSocket disconnected"),s(!1),t.current<5&&(t.current++,console.log("Reconnecting... (".concat(t.current,"/5)")),setTimeout(h,2e3))},a.onerror=e=>{console.error("WebSocket error:",e)}}catch(e){console.error("Failed to connect:",e)}},u=e=>{switch(e.type){case l.CONNECT:n(e.data.playerId),i(e.data.buildings||[]),console.log("Connected with ID:",e.data.playerId);break;case l.PLAYER_UPDATE:r(e.data);break;case l.GAME_STATE:e.data.players.forEach(e=>{r(e)});break;case l.DISCONNECT:o(e.data.playerId)}};h();let m=setInterval(()=>{var t;if((null===(t=e.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN){let t={x:a.position.x,y:a.position.y,z:a.position.z};c(t);let n={type:l.PLAYER_UPDATE,data:{position:t,rotation:a.rotation.y},timestamp:Date.now()};e.current.send(JSON.stringify(n))}},50);return()=>{clearInterval(m),e.current&&e.current.close()}},[a,n,s,r,o,i,c]),null}function B(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(u.Xz,{shadows:!0,camera:{position:[0,2,5],fov:75},style:{width:"100vw",height:"100vh"},children:[(0,h.jsx)(F,{}),(0,h.jsx)(m.q,{})]}),(0,h.jsx)(H,{}),(0,h.jsx)(G,{})]})}},489:function(e){e.exports={uiOverlay:"UI_uiOverlay__BKfMY",connectionStatus:"UI_connectionStatus__w3d7C",connected:"UI_connected__cT2Je",disconnected:"UI_disconnected___vRjL",statsPanel:"UI_statsPanel__17EBV",statBar:"UI_statBar__SRhef",statLabel:"UI_statLabel__NTNgO",bar:"UI_bar__2pXTm",barFill:"UI_barFill__r5Uke",hunger:"UI_hunger__66_q5",thirst:"UI_thirst__LV3Q_",energy:"UI_energy__aNiS3",health:"UI_health__cndGF",actionPrompt:"UI_actionPrompt__LEyc9",fadeIn:"UI_fadeIn__Yn6GH",actionsPanel:"UI_actionsPanel__H5jBH",actionBtn:"UI_actionBtn__s4aXI",controlsHelp:"UI_controlsHelp__DpTpS",playersList:"UI_playersList__N2Vqr",playersContainer:"UI_playersContainer__dHxIt",playerItem:"UI_playerItem__xJWpy"}}}]);